Author: Brian Miller
Date: 3/30/18

The finished .gtf (annotation file) with the new coordinates can be found at 'Couvillion_sRNA_Precursor_Annotations_2014updated.gtf'

Summary:
This document describes the process by which the sRNA precursor annotations (made from the 2006 genome) were updated to the 2014 genome. First the sequence for each differing annotation was extracted and the 2014 genome was searched by a local BLAT command and the single best HSP was taken as the new coordinates (all of this is done in 'blat_and_parse.py'). After the script ran properly, there were 20 annotations did not have the same sequence in the old and new genome. These annotations were manually searched via BLAST (http://www.ciliate.org/blast/blast_link.cgi with the T. thermophila Assembly (nucleotide) genome). From doing the BLASTing, it looks like my python script had the coordinates off by 1 nucleotide for some of the annotations. After this, there were still 10 annotations that did not have the same sequence in the old and new genome. These annotations were correct, but to explain them I used ClustalOmega (1.2.4) and BLAST on them again just to be sure. These annotations were different for a variety of reasons including: gaps in the 2006 genome that were filled in, repetitive sequences that were reduced, single nucleotide changes, and the switching of scaffold strandedness. For more on these ten annotations, see section 3.

1. Error during parse_and_blat.py
An error was raised when the CDS fa files from each genome were made, I looked online and the gffread program I am using has unfixed bug reports with similar issues so I assume that this is just a bug and needs to be worked around. The error was as follows:

"""
...making CDS fa using 2006 genome
Error (GFaSeqGet): end coordinate (86668) cannot be larger than sequence length 86667  
Error (GFaSeqGet): end coordinate (86668) cannot be larger than sequence length 86667
Error (GFaSeqGet): end coordinate (177921) cannot be larger than sequence length 177920  
Error (GFaSeqGet): end coordinate (177921) cannot be larger than sequence length 177920
BASH_cmd_stdout: 
...making CDS fa using 2014 genome
Error (GFaSeqGet): end coordinate (86668) cannot be larger than sequence length 86667
Error (GFaSeqGet): end coordinate (86668) cannot be larger than sequence length 86667
Error (GFaSeqGet): end coordinate (177921) cannot be larger than sequence length 177920
Error (GFaSeqGet): end coordinate (177921) cannot be larger than sequence length 177920
Warning: couldn't find fasta record for 'scf_8254745'!  
Warning: getSpliced(NULL,.. ) called!
Warning: couldn't find fasta record for 'scf_8254745'!
Warning: getSpliced(NULL,.. ) called!
"""
This shouldn't be an issue, for the sequence length should be 3224bp for Twi7.2 and 850bp for Twi7.2a. To work around this the end coordinate for "Twi7.2:Low-copy_repeat" and "Twi7.2:Low-copy_repeat" was changed from 86668 to 86667 (1nt) as this did not trigger the error. Also, the end coordinate for "_Twi7.2a:Low-copy_repeat" and "_Twi7.2a:Low-copy_repeat" was changed from 177921 to 177920 (1nt). 
Finally, I opened up the CDS files and checked that the sequences were the correct lengths and they were, issue resolved. After this fix the errors no longer showed up in the final python_terminal_output.txt file.

The 2006 scaffold scf_8254745 sequence was moved into the scf_8254470 scaffold in the new genome and thus the older scaffold no longer exists, this was not an issue as BLAT found the correct new location on the new scaffold for Ph6 annotation (only annotation on this scaffold), issue resolved.


2.
To verify that BLAT functioned as anticipated a new fa file from the new annotations and the 2014 genome was made and compared to the fa from the 2006 genome and the original annotations (Couvillion et al.). The python BLAT script ran and seemed to work but as you can see from the terminal output file 'python_terminal_output.txt' all 20 of the annotations (40 plus and minus) that needed to be updated showed that they still needed to be updated after the script had run. From here on I made a copy of the 'all_Couvillion_Ranges_for_RNAi_FROM2014_made.gtf' file called 'Couvillion_sRNA_Precursor_Annotations_2014updated.gtf' and manually BLASTed the 2014 genome for the new coordinates. In hindsight, some of the resulting coordinates were off my 1 nucleotide and this probably could have been fixed (as python is a 0 based language and I assume this was causing the differences) but I wanted to manually check them anyway so I just started doing that instead. NOTE on 3/31 this change was made and the

A small python script was continually used to attempt to verify (as described above) that the new annotations were correct, this python script is called 'verify_annotations.py' and the output from this script will be discussed from here on. After BLAST was used on every annotation there were ten annotations (20 if plus and minus) that still yielded a different sequence than what the 2006 genome proposed for the sequence (same verification step as above). So I used this script to give me some more information about the sequences that did not match up. 


3.
Below is a list of the ten annotations and more information on their updated coordinates.

For some of these 10, the coordinates and length are correct but interestingly the strandedness of the sequence is switched between the genome versions. For example the Twi7.1 Minus_strand 2006 sequence maps (via BLAST) perfectly to the plus strand of the 2014 genome. Presumably the strandedness of the whole scaffold was changed, this is not uncommon and is mentioned on UCSC's website about maintaining proper annotation sets (https://genome.ucsc.edu/goldenpath/help/hgTracksHelp.html#GetStarted). I will refer to this as 'Strandedness switched'.

Twi7.1:Low-copy_repeat
length of annotation from 2006 genome fa: 151 bp
length of annotation from 2014 genome fa: 151 bp
Reason for new annotation yielding different sequence:'Strandedness switched'

Twi8.2:EST-supported_Endo-siRNA-like
length of annotation from 2006 genome fa: 15001 bp
length of annotation from 2014 genome fa: 15001 bp
Reason for new annotation yielding different sequence:'Strandedness switched'

Twi8.3:EST-supported_Endo-siRNA-like
length of annotation from 2006 genome fa: 21501 bp
length of annotation from 2014 genome fa: 22832 bp  # 1331 bp more sequence in the new genome
The 2006 and 2014 sequences were aligned via ClustalOmega and both start and end have perfect matches (see the corresponding clustalOmega output file).
Reason for new annotation yielding different sequence: Multiple poly N sites have been replaced with more genomic sequence 

Twi8.5:EST-supported_Endo-siRNA-like
length of annotation from 2006 genome fa: 343300 bp  # 119 bp more sequence in the old genome
length of annotation from 2014 genome fa: 343181 bp
The 2006 and 2014 sequences could not be aligned with ClustalOmega as they were too long (from file 'Twi8.5:Plus_strand_clustalOmega_ready.fa') but the first 5000 bp and the last 5000 bp from each genome version were aligned and matched perfectly except for a single nucleotide deletion in a poly T locus in the 2014 genome version. This suggests that this is the correct annotation and the repetitive sections have probably been updated since 2006. See the first and last 5000 bp clustal Omega files if needed.
Reason for new annotation yielding different sequence: Repetitive genomic sequences have been updated and reduced

Twi8.10:EST-supported_Endo-siRNA-like
length of annotation from 2006 genome fa: 6201 bp
length of annotation from 2014 genome fa: 6201 bp
Reason for new annotation yielding different sequence:'Strandedness switched'

IB:Pseudogene_A-rich_tract
length of annotation from 2006 genome fa: 15001 bp
length of annotation from 2014 genome fa: 15940 bp  # 939 bp more sequences in the new genome
The 2006 and 2014 sequences were aligned via ClustalOmega and both start and end have perfect matches (see the corresponding clustalOmega output file).
Reason for new annotation yielding different sequence: Multiple poly N sites have been replaced with more genomic sequence

IC:Pseudogene_A-rich_tract
length of annotation from 2006 genome fa: 10001 bp
length of annotation from 2014 genome fa: 10001 bp
The 2006 sequence was manually BLASTed to the 2014 genome and both start and end sites for both strands have perfect matches but there were multiple  single nucleotide differences throughout the sequence. 
Reason for new annotation yielding different sequence: Change in many single nucleotide positions

IIIA:Pseudogene_A-rich_tract
length of annotation from 2006 genome fa: 3001 bp
length of annotation from 2014 genome fa: 3001 bp
Reason for new annotation yielding different sequence:'Strandedness switched'

VA:Pseudogene_A-rich_tract
length of annotation from 2006 genome fa: 6001 bp
length of annotation from 2014 genome fa: 6001 bp
Reason for new annotation yielding different sequence:'Strandedness switched'

Ph6:Phased_Hairpin
Ph6:Minus_Strand:Phased_Hairpin
length of annotation from 2006 genome fa: 2001 bp
length of annotation from 2014 genome fa: 2001 bp
Reason for new annotation yielding different sequence:'Strandedness switched'